<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nonni's Word Game</title>
    <style>
        :root {
            --ita-green: #2D5A27;
            --ita-ivory: #F9F7F2;
            --ita-red: #A63D33;
            --text-dark: #2C2C2C;
            --border-color: #D1C7B7;
            --font-main: 'Georgia', serif;
        }

        body {
            background-color: #E8E2D6;
            background-image: radial-gradient(#d1c7b7 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-dark);
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            width: 100%;
            max-width: 650px;
            border-bottom: 3px double var(--ita-green);
        }

        .italy-text span:nth-child(1) { color: var(--ita-green); }
        .italy-text span:nth-child(2) { color: #777; }
        .italy-text span:nth-child(3) { color: var(--ita-red); }

        .game-container {
            background-color: var(--ita-ivory);
            padding: 3rem;
            border-radius: 4px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 650px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            padding: 10px;
            border: 1px solid var(--ita-green);
            background: #fff;
            font-weight: bold;
        }

        /* NEW: Display for the base word without tiles */
        .base-word-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--ita-green);
            letter-spacing: 8px;
            margin-bottom: 1rem;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border-color);
            display: inline-block;
            padding: 0 20px 10px 20px;
        }

        .instructions {
            font-style: italic;
            color: #666;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .input-area {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        input[type="text"] {
            width: 60%;
            background: white;
            border: 1px solid var(--border-color);
            color: var(--text-dark);
            font-family: var(--font-main);
            font-size: 1.3rem;
            padding: 12px;
            outline: none;
            text-transform: uppercase;
        }

        button {
            background: var(--ita-green);
            border: none;
            color: white;
            padding: 12px 25px;
            font-family: var(--font-main);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        button#reset-btn {
            background: transparent;
            border: 1px solid var(--ita-red);
            color: var(--ita-red);
            margin-top: 20px;
        }

        .message {
            height: 24px;
            margin-bottom: 1rem;
            font-size: 1rem;
            font-weight: bold;
        }

        .msg-error { color: var(--ita-red); }
        .msg-success { color: var(--ita-green); }

        .found-words {
            text-align: left;
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .found-tag {
            background: #f0ede6;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }

        .loader {
            display: none;
            font-style: italic;
            color: #888;
        }
        .loader.active { display: block; }
    </style>
</head>
<body>

    <header>
        <h1 class="italy-text"><span>Nonni's</span><span> Word</span><span> Game</span></h1>
       
    </header>

    <div class="game-container">
        <div class="score-board">
            <span>PUNTEGGIO: <span id="score">0</span></span>
            <span>PAROLE: <span id="word-count">0</span></span>
        </div>

        <div class="base-word-display" id="base-word-text">LOADING...</div>
        <p class="instructions">How many new words can you make from the letters above?</p>

        <div class="message" id="message-area"></div>
        <div class="loader" id="loader">Consulting the dictionary...</div>

        <div class="input-area">
            <input type="text" id="user-input" placeholder="Type here..." autocomplete="off">
            <button id="submit-btn">Check</button>
        </div>

        <div class="found-words">
            <h3>Discovered Words:</h3>
            <div class="word-list" id="found-list"></div>
        </div>

        <button id="reset-btn">New Word / Reset</button>
    </div>

    <script>
        const SOURCE_WORDS = [
            "Ability","Backing","Cabinet","Absence","Balance","Calibre","Academy","Banking","Calling","Account","Barrier","Capable","Accused","Battery","Capital","Achieve","Bearing","Captain","Acquire","Beating","Caption","Address","Because","Capture","Advance","Bedroom","Careful","Adverse","Believe","Carrier","Advised","Beneath","Caution","Adviser","Benefit","Ceiling","Against","Besides","Central","Airline","Between","Centric","Airport","Billion","Century","Alcohol","Binding","Certain","Alleged","Brother","Chamber","Already","Brought","Channel","Analyst","Burning","Chapter","Ancient","Dealing","Charity","Another","Decided","Charlie","Anxiety","Decline","Charter","Anxious","Default","Checked","Anybody","Defence","Chicken","Applied","Deficit","Chronic","Arrange","Deliver","Circuit","Arrival","Density","Classes","Article","Deposit","Classic","Assault","Desktop","Climate","Assumed","Despite","Closing","Assured","Destroy","Closure","Attempt","Develop","Clothes","Attract","Devoted","Collect","Auction","Diamond","College","Average","Digital","Combine","Eastern","Discuss","Economy","Disease","Command","Edition","Display","Comment","Elderly","Dispute","Compact","Element","Distant","Company","Engaged","Diverse","Compare","Enhance","Divided","Compete","Essence","Drawing","Complex","Evening","Driving","Concept","Evident","Dynamic","Concern","Exactly","Factory","Concert","Examine","Faculty","Conduct","Example","Failing","Confirm","Excited","Failure","Connect","Exclude","Fashion","Consent","Exhibit","Feature","Consist","Expense","Federal","Contact","Explain","Feeling","Contain","Explore","Fiction","Content","Express","Fifteen","Contest","Extreme","Filling","Context","Gallery","Finance","Control","Gateway","Finding","Convert","General","Fishing","Correct","Genetic","Fitness","Council","Genuine","Foreign","Counsel","Gigabit","Forever","Counter","Greater","Formula","Country","Hanging","Fortune","Crucial","Heading","Forward","Crystal","Healthy","Founder","Culture","Hearing","Freedom","Current","Heavily","Further","Cutting","Helpful","Illegal","Jointly","Helping","Illness","Journal","Herself","Imagine","Journey","Highway","Imaging","Justice","Himself","Improve","Justify","History","Include","Keeping","Holding","Initial","Killing","Holiday","Inquiry","Kingdom","Housing","Insight","Kitchen","However","Install","Knowing","Hundred","Instant","Machine","Husband","Instead","Manager","Landing","Intense","Married","Largely","Interim","Massive","Lasting","Involve","Maximum","Leading","Natural","Meaning","Learned","Neither","Measure","Leisure","Nervous","Medical","Liberal","Network","Meeting","Liberty","Neutral","Mention","Library","Notable","Message","License","Nothing","Million","Limited","Nowhere","Mineral","Listing","Nuclear","Minimal","Logical","Nursing","Minimum","Loyalty","Pacific","Missing","Obvious","Package","Mission","Offence","Painted","Mistake","Officer","Parking","Mixture","Ongoing","Partial","Monitor","Opening","Partner","Monthly","Operate","Passage","Morning","Opinion","Passing","Musical","Optical","Passion","Mystery","Organic","Passive","Portion","Outcome","Patient","Poverty","Outdoor","Pattern","Precise","Outlook","Payable","Predict","Outside","Payment","Premier","Overall","Penalty","Premium","Proudly","Pending","Prepare","Project","Pension","Present","Promise","Pealing","Prevent","Promote","Perfect","Primary","Protect","Perform","Printer","Protein","Perhaps","Privacy","Protest","Phoenix","Private","Provide","Picking","Problem","Publish","Picture","Proceed","Purpose","Pioneer","Process","Pushing","Plastic","Produce","Qualify","Pointed","Product","Quality","Popular","Profile","Quarter","Section","Success","Radical","Segment","Suggest","Railway","Serious","Summary","Readily","Service","Support","Reading","Serving","Suppose","Reality","Session","Supreme","Realise","Setting","Surface","Receipt","Seventh","Surgery","Receive","Several","Surplus","Recover","Shortly","Survive","Reflect","Showing","Suspect","Regular","Silence","Sustain","Related","Silicon","Teacher","Release","Similar","Telecom","Remains","Sitting","Telling","Removal","Sixteen","Tension","Removed","Skilled","Theatre","Replace","Smoking","Therapy","Request","Society","Thereby","Require","Somehow","Thought","Reserve","SomeoneThrough","Resolve","Speaker","Tonight","Respect","Special","Totally","Respond","Species","Touched","Restore","Sponsor","Towards","Retired","Station","Traffic","Revenue","Storage","Trouble","Reverse","Strange","Turning","Rollout","Stretch","Typical","Routine","Student","Uniform","Running","Studied","Unknown","Satisfy","Subject","Unusual","Science","Succeed","Upgrade","Walking","Whether","Upscale","Wanting","Willing","Utility","Warning","Winning","Variety","Warrant","Without","Various","Wearing","Witness","Vehicle","Weather","Working","Venture","Webcast","Writing","Version","Website","Written","Veteran","Wedding","Western","Victory","Weekend","Whereas","Viewing","Welcome","Whereby","Village","Welfare","Virtual","Violent","Visible","Waiting"
        ];

        let currentBaseWord = "";
        let foundWords = new Set();
        let score = 0;

        const baseWordText = document.getElementById('base-word-text');
        const inputField = document.getElementById('user-input');
        const submitBtn = document.getElementById('submit-btn');
        const resetBtn = document.getElementById('reset-btn');
        const messageArea = document.getElementById('message-area');
        const scoreDisplay = document.getElementById('score');
        const countDisplay = document.getElementById('word-count');
        const foundList = document.getElementById('found-list');
        const loader = document.getElementById('loader');

        function initGame() {
            const randomIndex = Math.floor(Math.random() * SOURCE_WORDS.length);
            // Fix: Explicitly trim and capitalize to prevent empty strings/mismatch
            currentBaseWord = SOURCE_WORDS[randomIndex].trim().toUpperCase();
            
            foundWords.clear();
            score = 0;
            updateScoreBoard();
            foundList.innerHTML = '';
            inputField.value = '';
            messageArea.textContent = '';
            
            // Just show the word clearly
            baseWordText.textContent = currentBaseWord;
        }

        function updateScoreBoard() {
            scoreDisplay.textContent = score;
            countDisplay.textContent = foundWords.size;
        }

        function showMessage(msg, type) {
            messageArea.textContent = msg;
            messageArea.className = `message msg-${type}`;
        }

        function canFormWord(testWord, sourceWord) {
            const sourceMap = {};
            for (let char of sourceWord) {
                sourceMap[char] = (sourceMap[char] || 0) + 1;
            }
            for (let char of testWord) {
                if (!sourceMap[char]) return false;
                sourceMap[char]--;
            }
            return true;
        }

        async function isValidDictionaryWord(word) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if (!response.ok) return false;
                const data = await response.json();
                return Array.isArray(data) && data.length > 0;
            } catch (err) {
                return false;
            }
        }

        async function handleSubmission() {
            const guess = inputField.value.trim().toUpperCase();
            
            if (!guess) return;
            
            // Bug fix check: ensure currentBaseWord is set
            if (!currentBaseWord) {
                initGame();
                return;
            }

            if (guess.length < 3) {
                showMessage("A bit too short, dear! (3+ letters)", "error");
                return;
            }

            if (guess === currentBaseWord) {
                showMessage("You can't use the original word!", "error");
                return;
            }

            if (foundWords.has(guess)) {
                showMessage("You already found that one.", "error");
                return;
            }

            // Client-side letter check
            if (!canFormWord(guess, currentBaseWord)) {
                showMessage("You used letters not found in " + currentBaseWord, "error");
                return;
            }

            loader.classList.add('active');
            submitBtn.disabled = true;

            const isValid = await isValidDictionaryWord(guess);

            loader.classList.remove('active');
            submitBtn.disabled = false;

            if (isValid) {
                foundWords.add(guess);
                score += guess.length - 2;
                //score++;
                updateScoreBoard();
                const tag = document.createElement('div');
                tag.className = 'found-tag';
                tag.textContent = guess;
                foundList.prepend(tag);
                showMessage("Bravissimo! +1", "success");
                inputField.value = '';
                inputField.focus();
            } else {
                showMessage("That doesn't seem to be a word.", "error");
            }
        }

        submitBtn.addEventListener('click', handleSubmission);
        inputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSubmission();
        });
        resetBtn.addEventListener('click', initGame);

        // Run once on start
        window.onload = initGame;
    </script>
</body>
</html>
